"
A PharoTopicsMdPageTool generates a markdown for master and bachelor topics.

PharoTopicsMdPageTool
	new 
	dataFromUrl: 'https://raw.github.com/pharo-project/pharo-project-proposals/master/Topics.st';
	generatePageFile.

For debugging 
	
PharoTopicsMdPageTool new
	dataFromFile: '/home/peter/prog/gsoc/pharo-project-proposals/Topics.st' asFileReference;
	generatePageFile: '/home/peter/prog/gsoc/pharo-project-proposals/Topics.md'
"
Class {
	#name : #PharoTopicsMdPageTool,
	#superclass : #PharoPeoplePageTool,
	#category : #PharoPeople
}

{ #category : #'html generation' }
PharoTopicsMdPageTool >> anchorForTitle: aTitle [
	"GitHub autogenerated anchors don't contain spaces nor special characters"

	^ (aTitle asLowercase copyReplaceAll: ' ' with: '-')
		copyWithRegex: '[^a-zA-Z0-9\-]'
		matchesReplacedWith: ''
]

{ #category : #accessing }
PharoTopicsMdPageTool >> dataFromFile: filepath [
	"Assuming filepath points to a file containing Smalltalk expressions separated by dots on a line on their own, 
	evaluate the objects found there and assign them to data"
	
	| separator fileContents in |
	separator := String lf, '.', String lf, String lf.
	fileContents := filepath asFileReference contents.
	data := Array streamContents: [ :out |
		in := fileContents readStream.
		[ | oneTopic |
			oneTopic := (in upToAll: separator) trimBoth.
			oneTopic isEmpty
				ifTrue: [ false ]
				ifFalse: [ 
					out nextPut: ([ Compiler new evaluate: oneTopic ] on: Error do: [ :e | e inspect. oneTopic inspect. self halt ]).
					true ] ] whileTrue ]
]

{ #category : #accessing }
PharoTopicsMdPageTool >> dataFromUrl: url [
	"Assuming url points to a file containing Smalltalk expressions separated by dots on a line on their own, 
	evaluate the objects found there and assign them to data"
	
	| separator fileContents in |
	separator := String lf, '.', String lf, String lf.
	fileContents := ZnClient new get: url.
	data := Array streamContents: [ :out |
		in := fileContents readStream.
		[ | oneTopic |
			oneTopic := (in upToAll: separator) trimBoth.
			oneTopic isEmpty
				ifTrue: [ false ]
				ifFalse: [ 
					out nextPut: (Compiler new evaluate: oneTopic).
					true ] ] whileTrue ]
]

{ #category : #default }
PharoTopicsMdPageTool >> defaultFile [
	^ 'pharo-topics'
]

{ #category : #default }
PharoTopicsMdPageTool >> defaultHtmlFile [
	^ self defaultFile, '.md'
]

{ #category : #'html generation' }
PharoTopicsMdPageTool >> generateBody [
	stream << self title << String crlfcrlf.
	stream << self preamble.
	self generateToc.
	data
		do:
			[ :each | 
			self generateEntryFor: each.
			stream << String crlf << '***' << String crlfcrlf ].
	stream << self postamble
]

{ #category : #'html generation' }
PharoTopicsMdPageTool >> generateEntryElementsFor: topic [
	stream << '##Title: ' << topic title << String crlf.
	#(#contact #supervisors #keywords)
		do:
			[ :each | stream << '###' << each capitalized << ': ' << (each value: topic) << String crlf ].
	stream << '###' << 'Context' << String crlf << topic context << String crlf.
	stream << '###' << 'Goal' << String crlf << topic goal << String crlf.
	stream << '###' << 'Level: ' << topic level << String crlf
]

{ #category : #'html generation' }
PharoTopicsMdPageTool >> generateEntryFor: topic [
	self generateEntryElementsFor: topic
]

{ #category : #'html generation' }
PharoTopicsMdPageTool >> generatePage [
	self generateBody
]

{ #category : #'html generation' }
PharoTopicsMdPageTool >> generateToc [
	data
		do:
			[ :each | 
			stream << '* ' << '[' << each title << ']'.
			stream << '(#title-' << (self anchorForTitle: each title) << ')'.
			stream << String crlf ].
	stream << String crlf
]

{ #category : #constants }
PharoTopicsMdPageTool >> preamble [
	^ ''
]

{ #category : #constants }
PharoTopicsMdPageTool >> title [
	^ '#Pharo GSOC Topics'
]
